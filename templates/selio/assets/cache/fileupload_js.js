!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(i){"use strict";var a=0;i.ajaxTransport("iframe",function(n){var o,p,t;if(n.async)return{send:function(e,r){(o=i('<form style="display:none;"></form>')).attr("accept-charset",n.formAcceptCharset),t=/\?/.test(n.url)?"&":"?","DELETE"===n.type?(n.url=n.url+t+"_method=DELETE",n.type="POST"):"PUT"===n.type?(n.url=n.url+t+"_method=PUT",n.type="POST"):"PATCH"===n.type&&(n.url=n.url+t+"_method=PATCH",n.type="POST"),p=i('<iframe src="javascript:false;" name="iframe-transport-'+(a+=1)+'"></iframe>').bind("load",function(){var a,t=i.isArray(n.paramName)?n.paramName:[n.paramName];p.unbind("load").bind("load",function(){var t;try{if(!(t=p.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}r(200,"success",{iframe:t}),i('<iframe src="javascript:false;"></iframe>').appendTo(o),o.remove()}),o.prop("target",p.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&i.each(n.formData,function(e,t){i('<input type="hidden"/>').prop("name",t.name).val(t.value).appendTo(o)}),n.fileInput&&n.fileInput.length&&"POST"===n.type&&(a=n.fileInput.clone(),n.fileInput.after(function(e){return a[e]}),n.paramName&&n.fileInput.each(function(e){i(this).prop("name",t[e]||n.paramName)}),o.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),o.submit(),a&&a.length&&n.fileInput.each(function(e,t){var r=i(a[e]);i(t).prop("name",r.prop("name")),r.replaceWith(t)})}),o.append(p).appendTo(document.body)},abort:function(){p&&p.unbind("load").prop("src","javascript".concat(":false;")),o&&o.remove()}}}),i.ajaxSetup({converters:{"iframe text":function(e){return e&&i(e[0].body).text()},"iframe json":function(e){return e&&i.parseJSON(i(e[0].body).text())},"iframe html":function(e){return e&&i(e[0].body).html()},"iframe script":function(e){return e&&i.globalEval(i(e[0].body).text())}}})});!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(f){"use strict";f.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),f.support.xhrFormDataFileUpload=!!window.FormData,f.propHooks.elements={get:function(e){return f.nodeName(e,"form")?f.grep(e.elements,function(e){return!f.nodeName(e,"input")||"file"!==e.type}):null}},f.widget("blueimp.fileupload",{options:{dropZone:f(document),pasteZone:f(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(e){return e.serializeArray()},add:function(e,t){t.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return this.bitrate&&i&&!(i<n)||(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&f.support.xhrFileUpload||f.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"==typeof e.formData?e.formData(e.form):f.isArray(e.formData)?e.formData:e.formData?(i=[],f.each(e.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(e){var i=0;return f.each(e,function(e,t){i+=t.size||1}),i},_onProgress:function(e,t){if(e.lengthComputable){var i,n,r=+new Date;if(t._time&&t.progressInterval&&r-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=r,i=t.total||this._getTotal(t.files),n=parseInt(e.loaded/e.total*(t.chunkSize||i),10)+(t.uploadedBytes||0),this._loaded+=n-(t.loaded||t.uploadedBytes||0),t.lengthComputable=!0,t.loaded=n,t.total=i,t.bitrate=t._bitrateTimer.getBitrate(r,n,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(r,this._loaded,t.bitrateInterval)})}},_initProgressListener:function(i){var n=this,e=i.xhr?i.xhr():f.ajaxSettings.xhr();e.upload&&(f(e.upload).bind("progress",function(e){var t=e.originalEvent;e.lengthComputable=t.lengthComputable,e.loaded=t.loaded,e.total=t.total,n._onProgress(e,i)}),i.xhr=function(){return e})},_initXHRData:function(i){var n,e=i.files[0],t=i.multipart||!f.support.xhrFileUpload,r=i.paramName[0];i.headers=i.headers||{},i.contentRange&&(i.headers["Content-Range"]=i.contentRange),t?f.support.xhrFormDataFileUpload&&(i.postMessage?(n=this._getFormData(i),i.blob?n.push({name:r,value:i.blob}):f.each(i.files,function(e,t){n.push({name:i.paramName[e]||r,value:t})})):(i.formData instanceof FormData?n=i.formData:(n=new FormData,f.each(this._getFormData(i),function(e,t){n.append(t.name,t.value)})),i.blob?(i.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"',n.append(r,i.blob,e.name)):f.each(i.files,function(e,t){(window.Blob&&t instanceof Blob||window.File&&t instanceof File)&&n.append(i.paramName[e]||r,t,t.name)})),i.data=n):(i.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"',i.contentType=e.type,i.data=i.blob||e),i.blob=null},_initIframeSettings:function(e){e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&f("<a></a>").prop("href",e.url).prop("host")!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_getParamName:function(e){var t=f(e.fileInput),n=e.paramName;return n?f.isArray(n)||(n=[n]):(n=[],t.each(function(){for(var e=f(this),t=e.prop("name")||"files[]",i=(e.prop("files")||[1]).length;i;)n.push(t),i-=1}),n.length||(n=[t.prop("name")||"files[]"])),n},_initFormSettings:function(e){e.form&&e.form.length||(e.form=f(e.fileInput.prop("form")),e.form.length||(e.form=f(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=f.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,i){var n=f.Deferred(),r=n.promise();return t=t||this.options.context||r,!0===e?n.resolveWith(t,i):!1===e&&n.rejectWith(t,i),r.abort=n.promise,this._enhancePromise(r)},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&1<i.length&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(r,e){var t,o,a=this,i=r.files[0],s=i.size,l=r.uploadedBytes=r.uploadedBytes||0,p=r.maxChunkSize||s,u=i.slice||i.webkitSlice||i.mozSlice,d=f.Deferred(),n=d.promise();return!(!(this._isXHRUpload(r)&&u&&(l||p<s))||r.data)&&(!!e||(s<=l?(i.error="Uploaded bytes exceed file size",this._getXHRPromise(!1,r.context,[null,"error",i.error])):(o=function(){var n=f.extend({},r);n.blob=u.call(i,l,l+p,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+s,a._initXHRData(n),a._initProgressListener(n),t=(!1!==a._trigger("chunksend",null,n)&&f.ajax(n)||a._getXHRPromise(!1,n.context)).done(function(e,t,i){l=a._getUploadedBytes(i)||l+n.chunkSize,(!n.loaded||n.loaded<n.total)&&a._onProgress(f.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),r.uploadedBytes=n.uploadedBytes=l,n.result=e,n.textStatus=t,n.jqXHR=i,a._trigger("chunkdone",null,n),a._trigger("chunkalways",null,n),l<s?o():d.resolveWith(n.context,[e,t,i])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,a._trigger("chunkfail",null,n),a._trigger("chunkalways",null,n),d.rejectWith(n.context,[e,t,i])})},this._enhancePromise(n),n.abort=function(){return t.abort()},o(),n)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=t.uploadedBytes||0,this._total+=this._getTotal(t.files)},_onDone:function(e,t,i,n){if(!this._isXHRUpload(n)||!n.loaded||n.loaded<n.total){var r=this._getTotal(n.files)||1;this._onProgress(f.Event("progress",{lengthComputable:!0,loaded:r,total:r}),n)}n.result=e,n.textStatus=t,n.jqXHR=i,this._trigger("done",null,n)},_onFail:function(e,t,i,n){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,this._trigger("fail",null,n),n.recalculateProgress&&(this._loaded-=n.loaded||n.uploadedBytes||0,this._total-=n.total||this._getTotal(n.files))},_onAlways:function(e,t,i,n){this._active-=1,this._trigger("always",null,n),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(e,t){function i(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,n=n||((r||!1===s._trigger("send",e,l))&&s._getXHRPromise(!1,l.context,r)||s._chunkedUpload(l)||f.ajax(l)).done(function(e,t,i){s._onDone(e,t,i,l)}).fail(function(e,t,i){s._onFail(e,t,i,l)}).always(function(e,t,i){if(s._sending-=1,s._onAlways(e,t,i,l),l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var n=s._slots.shift();n;){if(n.state?"pending"===n.state():!n.isRejected()){n.resolve();break}n=s._slots.shift()}})}var n,r,o,a,s=this,l=s._getAJAXSettings(t);return this._beforeSend(e,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?((a=1<this.options.limitConcurrentUploads?(o=f.Deferred(),this._slots.push(o),o.pipe(i)):this._sequence=this._sequence.pipe(i,i)).abort=function(){return r=[void 0,"abort","abort"],n?n.abort():(o&&o.rejectWith(l.context,r),i())},this._enhancePromise(a)):i()},_onAdd:function(n,r){var o,e,a,t,s=this,l=!0,i=f.extend({},this.options,r),p=i.limitMultiFileUploads,u=this._getParamName(i);if((i.singleFileUploads||p)&&this._isXHRUpload(i))if(!i.singleFileUploads&&p)for(a=[],o=[],t=0;t<r.files.length;t+=p)a.push(r.files.slice(t,t+p)),(e=u.slice(t,t+p)).length||(e=u),o.push(e);else o=u;else a=[r.files],o=[u];return r.originalFiles=r.files,f.each(a||r.files,function(e,t){var i=f.extend({},r);return i.files=a?t:[t],i.paramName=o[e],i.submit=function(){return i.jqXHR=this.jqXHR=!1!==s._trigger("submit",n,this)&&s._onSend(n,this),this.jqXHR},l=s._trigger("add",n,i)}),l},_replaceFileInput:function(i){var n=i.clone(!0);f("<form></form>").append(n)[0].reset(),i.after(n).detach(),f.cleanData(i.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===i[0]?n[0]:t}),i[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,i){function n(e){e&&!e.entry&&(e.entry=t),o.resolve([e])}var r=this,o=f.Deferred();return i=i||"",t.isFile?t._file?(t._file.relativePath=i,o.resolve(t._file)):t.file(function(e){e.relativePath=i,o.resolve(e)},n):t.isDirectory?t.createReader().readEntries(function(e){r._handleFileTreeEntries(e,i+t.name+"/").done(function(e){o.resolve(e)}).fail(n)},n):o.resolve([]),o.promise()},_handleFileTreeEntries:function(e,t){var i=this;return f.when.apply(f,f.map(e,function(e){return i._handleFileTreeEntry(e,t)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){var t=(e=e||{}).items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries(f.map(t,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):f.Deferred().resolve(f.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){var t,i,n=(e=f(e)).prop("webkitEntries")||e.prop("entries");if(n&&n.length)return this._handleFileTreeEntries(n);if((t=f.makeArray(e.prop("files"))).length)void 0===t[0].name&&t[0].fileName&&f.each(t,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(i=e.prop("value")))return f.Deferred().resolve([]).promise();t=[{name:i.replace(/^.*\\/,"")}]}return f.Deferred().resolve(t).promise()},_getFileInputFiles:function(e){return e instanceof f&&1!==e.length?f.when.apply(f,f.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(t){var i=this,n={fileInput:f(t.target),form:f(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(e){n.files=e,i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),!1!==i._trigger("change",t,n)&&i._onAdd(t,n)})},_onPaste:function(e){var t=e.originalEvent.clipboardData,i=t&&t.items||[],n={files:[]};if(f.each(i,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),!1===this._trigger("paste",e,n)||!1===this._onAdd(e,n))return!1},_onDrop:function(t){var i=this,e=t.dataTransfer=t.originalEvent.dataTransfer,n={};e&&e.files&&e.files.length&&t.preventDefault(),this._getDroppedFiles(e).always(function(e){n.files=e,!1!==i._trigger("drop",t,n)&&i._onAdd(t,n)})},_onDragOver:function(e){var t=e.dataTransfer=e.originalEvent.dataTransfer;if(!1===this._trigger("dragover",e))return!1;t&&-1!==f.inArray("Files",t.types)&&(t.dropEffect="copy",e.preventDefault())},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,t){var i=-1!==f.inArray(e,this._refreshOptionsList);i&&this._destroyEventHandlers(),this._super(e,t),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof f||(e.fileInput=f(e.fileInput)),e.dropZone instanceof f||(e.dropZone=f(e.dropZone)),e.pasteZone instanceof f||(e.pasteZone=f(e.pasteZone))},_create:function(){var e=this.options;f.extend(e,f(this.element[0].cloneNode(!1)).data()),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},_destroy:function(){this._destroyEventHandlers()},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=f.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,r=this,o=f.Deferred(),e=o.promise();return e.abort=function(){return n=!0,i?i.abort():(o.reject(null,"abort","abort"),e)},this._getFileInputFiles(t.fileInput).always(function(e){n||(t.files=e,i=r._onSend(null,t).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)}))}),this._enhancePromise(e)}if(t.files=f.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],e):e(window.jQuery,window.loadImage)}(function(a,o){"use strict";a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{process:[],add:function(e,i){a(this).fileupload("process",i).done(function(){i.submit()})}},processActions:{load:function(i,e){var s=this,n=i.files[i.index],t=a.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==a.type(e.maxFileSize)||n.size<e.maxFileSize)&&(!e.fileTypes||e.fileTypes.test(n.type))?o(n,function(e){if(!e.src)return t.rejectWith(s,[i]);i.img=e,t.resolveWith(s,[i])}):t.rejectWith(s,[i]),t.promise()},resize:function(e,i){var s,n=e.img;return i=a.extend({canvas:!0},i),n&&((s=o.scale(n,i)).width===n.width&&s.height===n.height||(e.canvas=s)),e},save:function(i,e){if(!i.canvas)return i;function s(e){e.name||(t.type===e.type?e.name=t.name:t.name&&(e.name=t.name.replace(/\..+$/,"."+e.type.substr(6)))),i.files[i.index]=e,r.resolveWith(n,[i])}var n=this,t=i.files[i.index],o=t.name,r=a.Deferred();return i.canvas.mozGetAsFile?s(i.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(t.type)&&o||(o&&o.replace(/\..+$/,"")||"blob")+".png",t.type)):i.canvas.toBlob(s,t.type),r.promise()}},_processFile:function(e,i,s){var n=this,t=a.Deferred().resolveWith(n,[{files:e,index:i}]).promise();return n._processing+=1,a.each(s.process,function(e,i){t=t.pipe(function(e){return n.processActions[i.action].call(this,e,i)})}),t.always(function(){n._processing-=1,0===n._processing&&n.element.removeClass("fileupload-processing")}),1===n._processing&&n.element.addClass("fileupload-processing"),t},process:function(s){var n=this,t=a.extend({},this.options,s);return t.process&&t.process.length&&this._isXHRUpload(t)&&a.each(s.files,function(i,e){n._processingQueue=n._processingQueue.pipe(function(){var e=a.Deferred();return n._processFile(s.files,i,t).always(function(){e.resolveWith(n)}),e.promise()})}),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=a.Deferred().resolveWith(this).promise()}})});!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],e):e(window.jQuery,window.tmpl,window.loadImage)}(function(d,t,o){"use strict";d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:void 0,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",add:function(e,t){var i=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),n=i.options,r=t.files;d(this).fileupload("process",t).done(function(){i._adjustMaxNumberOfFiles(-r.length),t.maxNumberOfFilesAdjusted=!0,t.files.valid=t.isValidated=i._validate(r),t.context=i._renderUpload(r).data("data",t),n.filesContainer[n.prependFiles?"prepend":"append"](t.context),i._renderPreviews(t),i._forceReflow(t.context),i._transition(t.context).done(function(){!1!==i._trigger("added",e,t)&&(n.autoUpload||t.autoUpload)&&!1!==t.autoUpload&&t.isValidated&&t.submit()})})},send:function(e,t){var i=d(this).data("blueimp-fileupload")||d(this).data("fileupload");return!(!t.isValidated&&(t.maxNumberOfFilesAdjusted||(i._adjustMaxNumberOfFiles(-t.files.length),t.maxNumberOfFilesAdjusted=!0),!i._validate(t.files)))&&(t.context&&t.dataType&&"iframe"===t.dataType.substr(0,6)&&t.context.find(".progress").addClass(!d.support.transition&&"progress-animated").attr("aria-valuenow",100).find(".bar").css("width","100%"),i._trigger("sent",e,t))},done:function(n,r){var o,e,s=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),a=s._getFilesFromResponse(r);r.context?r.context.each(function(e){var t=a[e]||{error:"Empty file upload result"},i=s._addFinishedDeferreds();t.error&&s._adjustMaxNumberOfFiles(1),s._transition(d(this)).done(function(){var e=d(this);o=s._renderDownload([t]).replaceAll(e),s._forceReflow(o),s._transition(o).done(function(){r.context=d(this),s._trigger("completed",n,r),s._trigger("finished",n,r),i.resolve()})})}):(a.length&&(d.each(a,function(e,t){r.maxNumberOfFilesAdjusted&&t.error?s._adjustMaxNumberOfFiles(1):r.maxNumberOfFilesAdjusted||t.error||s._adjustMaxNumberOfFiles(-1)}),r.maxNumberOfFilesAdjusted=!0),o=s._renderDownload(a).appendTo(s.options.filesContainer),s._forceReflow(o),e=s._addFinishedDeferreds(),s._transition(o).done(function(){r.context=d(this),s._trigger("completed",n,r),s._trigger("finished",n,r),e.resolve()}))},fail:function(i,n){var r,o,s=d(this).data("blueimp-fileupload")||d(this).data("fileupload");n.maxNumberOfFilesAdjusted&&s._adjustMaxNumberOfFiles(n.files.length),n.context?n.context.each(function(e){if("abort"!==n.errorThrown){var t=n.files[e];t.error=t.error||n.errorThrown||!0,o=s._addFinishedDeferreds(),s._transition(d(this)).done(function(){var e=d(this);r=s._renderDownload([t]).replaceAll(e),s._forceReflow(r),s._transition(r).done(function(){n.context=d(this),s._trigger("failed",i,n),s._trigger("finished",i,n),o.resolve()})})}else o=s._addFinishedDeferreds(),s._transition(d(this)).done(function(){d(this).remove(),s._trigger("failed",i,n),s._trigger("finished",i,n),o.resolve()})}):"abort"!==n.errorThrown?(n.context=s._renderUpload(n.files).appendTo(s.options.filesContainer).data("data",n),s._forceReflow(n.context),o=s._addFinishedDeferreds(),s._transition(n.context).done(function(){n.context=d(this),s._trigger("failed",i,n),s._trigger("finished",i,n),o.resolve()})):(s._trigger("failed",i,n),s._trigger("finished",i,n),s._addFinishedDeferreds().resolve())},progress:function(e,t){if(t.context){var i=parseInt(t.loaded/t.total*100,10);t.context.find(".progress").attr("aria-valuenow",i).find(".bar").css("width",i+"%")}},progressall:function(e,t){var i=d(this),n=parseInt(t.loaded/t.total*100,10),r=i.find(".fileupload-progress"),o=r.find(".progress-extended");o.length&&o.html((i.data("blueimp-fileupload")||i.data("fileupload"))._renderExtendedProgress(t)),r.find(".progress").attr("aria-valuenow",n).find(".bar").css("width",n+"%")},start:function(e){var t=d(this).data("blueimp-fileupload")||d(this).data("fileupload");t._resetFinishedDeferreds(),t._transition(d(this).find(".fileupload-progress")).done(function(){t._trigger("started",e)})},stop:function(e){var t=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),i=t._addFinishedDeferreds();d.when.apply(d,t._getFinishedDeferreds()).done(function(){t._trigger("stopped",e)}),t._transition(d(this).find(".fileupload-progress")).done(function(){d(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%"),d(this).find(".progress-extended").html("&nbsp;"),i.resolve()})},destroy:function(t,e){var i=d(this).data("blueimp-fileupload")||d(this).data("fileupload");e.url&&(d.ajax(e).done(function(e){e.hasOwnProperty("success")&&e.success&&d(this).remove(),i._trigger("destroyed",t,e)}).fail(function(){alert("error during ajax call")}),i._adjustMaxNumberOfFiles(1))}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(e){return e=e||d.Deferred(),this._finishedUploads.push(e),e},_getFinishedDeferreds:function(){return this._finishedUploads},_getFilesFromResponse:function(e){return e.result&&d.isArray(e.result.files)?e.result.files:[]},_enableDragToDesktop:function(){var e=d(this),t=e.prop("href"),i=e.prop("download"),n="application/octet-stream";e.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[n,i,t].join(":"))}catch(e){}})},_adjustMaxNumberOfFiles:function(e){"number"==typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=e,this.options.maxNumberOfFiles<1?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" GB":1e6<=e?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" Gbit/s":1e6<=e?(e/1e6).toFixed(2)+" Mbit/s":1e3<=e?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),i=parseInt(e/86400,10);return(i=i?i+"d ":"")+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_hasError:function(e){return e.error?e.error:this.options.maxNumberOfFiles<0?"Maximum number of files exceeded":this.options.acceptFileTypes.test(e.type)||this.options.acceptFileTypes.test(e.name)?this.options.maxFileSize&&e.size>this.options.maxFileSize?"File is too big":"number"==typeof e.size&&e.size<this.options.minFileSize?"File is too small":null:"Filetype not allowed"},_validate:function(e){var i=this,n=!!e.length;return d.each(e,function(e,t){t.error=i._hasError(t),t.error&&(n=!1)}),n},_renderTemplate:function(e,t){if(!e)return d();var i=e({files:t,formatFileSize:this._formatFileSize,options:this.options});return i instanceof d?i:d(this.options.templatesContainer).html(i).children()},_renderPreview:function(e,t){var i=this,n=this.options,r=d.Deferred();return(o&&o(e,function(e){t.append(e),i._forceReflow(t),i._transition(t).done(function(){r.resolveWith(t)}),d.contains(i.document[0].body,t[0])||r.resolveWith(t)},{maxWidth:n.previewMaxWidth,maxHeight:n.previewMaxHeight,canvas:n.previewAsCanvas})||r.resolveWith(t))&&r},_renderPreviews:function(r){var o=this,t=this.options;return r.context.find(".preview span").each(function(e,i){var n=r.files[e];t.previewSourceFileTypes.test(n.type)&&("number"!==d.type(t.previewSourceMaxFileSize)||n.size<t.previewSourceMaxFileSize)&&(o._processingQueue=o._processingQueue.pipe(function(){var e=d.Deferred(),t=d.Event("previewdone",{target:i});return o._renderPreview(n,d(i)).done(function(){o._trigger(t.type,t,r),e.resolveWith(o)}),e.promise()}))}),this._processingQueue},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(e){e.preventDefault();var t=d(e.currentTarget),i=t.closest(".template-upload").data("data");i&&i.submit&&!i.jqXHR&&i.submit()&&t.prop("disabled",!0)},_cancelHandler:function(e){e.preventDefault();var t=d(e.currentTarget).closest(".template-upload").data("data")||{};t.jqXHR?t.jqXHR.abort():(t.errorThrown="abort",this._trigger("fail",e,t))},_deleteHandler:function(e){e.preventDefault();var t=d(e.currentTarget);this._trigger("destroy",e,d.extend({context:t.closest(".template-download"),type:"DELETE",dataType:this.options.dataType},t.data()))},_forceReflow:function(e){return d.support.transition&&e.length&&e[0].offsetWidth},_transition:function(t){var i=d.Deferred();return d.support.transition&&t.hasClass("fade")?t.bind(d.support.transition.end,function(e){e.target===t[0]&&(t.unbind(d.support.transition.end),i.resolveWith(t))}).toggleClass("in"):(t.toggleClass("in"),i.resolveWith(t)),i},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer;this._on(t.find(".start"),{click:function(e){e.preventDefault(),i.find(".start button").click()}}),this._on(t.find(".cancel"),{click:function(e){e.preventDefault(),i.find(".cancel button").click()}}),this._on(t.find(".delete"),{click:function(e){e.preventDefault(),i.find(".delete input:checked").siblings("button").click(),t.find(".toggle").prop("checked",!1)}}),this._on(t.find(".toggle"),{change:function(e){i.find(".delete input").prop("checked",d(e.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar button"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .start button":this._startHandler,"click .cancel button":this._cancelHandler,"click .delete button":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),t&&(e.uploadTemplateId&&(e.uploadTemplate=t(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=t(e.downloadTemplateId)))},_initFilesContainer:function(){var e=this.options;void 0===e.filesContainer?e.filesContainer=this.element.find(".files"):e.filesContainer instanceof d||(e.filesContainer=d(e.filesContainer))},_stringToRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_initRegExpOptions:function(){var e=this.options;"string"===d.type(e.acceptFileTypes)&&(e.acceptFileTypes=this._stringToRegExp(e.acceptFileTypes)),"string"===d.type(e.previewSourceFileTypes)&&(e.previewSourceFileTypes=this._stringToRegExp(e.previewSourceFileTypes))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates(),this._initRegExpOptions()},_setOption:function(e,t){this._super(e,t),"maxNumberOfFiles"===e&&this._adjustMaxNumberOfFiles(0)},_create:function(){this._super(),this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId"),this._processingQueue||(this._processingQueue=d.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue}),this._resetFinishedDeferreds()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})});